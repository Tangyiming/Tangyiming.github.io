(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{149:function(n){n.exports=JSON.parse('{"data":{"tag":{"title":"debounce","belongsTo":{"edges":[{"node":{"title":"Vue防抖并赋值data值","path":"/debounce-in-vue","date":"7. November 2019","timeToRead":1,"description":"远程模糊搜索select下拉项时，为了避免输入时过多的请求，在vue中添加优化防抖功能","coverImage":null,"content":"<p>远程模糊搜索select下拉项时，为了避免输入时过多的请求，在vue中添加优化防抖功能，但是中间遇到了两个问题：</p>\\n<p>1.防抖不起作用，根本不delay，最终发现是函数声明方式导致。使用箭头函数声明，箭头函数体内的this对象，就是定义时所在的对象，而不是使用时所在的对象，它是固定不变的。</p>\\n<p>2.因为箭头函数里this指向作用域问题，无法给data中的变量赋值，最终通过先获得顶层this域，再赋值解决。</p>\\n<p>上代码：</p>\\n<pre class=\\"language-js\\"><span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">!</span><span class=\\"token operator\\">--</span>省略<span class=\\"token operator\\">--</span><span class=\\"token operator\\">></span>\\n     <span class=\\"token operator\\">&lt;</span>a<span class=\\"token operator\\">-</span>select\\n       showSearch\\n       allowClear\\n       <span class=\\"token operator\\">:</span>value<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"department\\"</span>\\n       <span class=\\"token operator\\">:</span>defaultActiveFirstOption<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"false\\"</span>\\n       <span class=\\"token operator\\">:</span>showArrow<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"false\\"</span>\\n       <span class=\\"token operator\\">:</span>filterOption<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"false\\"</span>\\n       @search<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"val => handleSearch(\'department\', val)\\"</span>\\n       @change<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"val => handleChange(\'department\', val)\\"</span><span class=\\"token operator\\">></span>\\n           <span class=\\"token operator\\">&lt;</span>a<span class=\\"token operator\\">-</span>select<span class=\\"token operator\\">-</span>option\\n            v<span class=\\"token operator\\">-</span><span class=\\"token keyword\\">for</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"d in departmentList\\"</span>\\n            <span class=\\"token operator\\">:</span>key<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"d\\"</span>\\n            <span class=\\"token operator\\">></span><span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">{</span> d <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">}</span><span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span>a<span class=\\"token operator\\">-</span>select<span class=\\"token operator\\">-</span>option\\n           <span class=\\"token operator\\">></span>\\n     <span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span>a<span class=\\"token operator\\">-</span>select<span class=\\"token operator\\">></span>\\n<span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">!</span><span class=\\"token operator\\">--</span>省略<span class=\\"token operator\\">--</span><span class=\\"token operator\\">></span>\\n\\n<span class=\\"token keyword module\\">import</span> <span class=\\"token punctuation\\">{</span> queryAsset <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword module\\">from</span> <span class=\\"token string\\">\'@/api/toolset\'</span>\\n<span class=\\"token keyword module\\">import</span> _ <span class=\\"token keyword module\\">from</span> <span class=\\"token string\\">\'lodash\'</span>\\n<span class=\\"token keyword\\">let</span> _this <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span>\\n<span class=\\"token operator\\">&lt;</span>script<span class=\\"token operator\\">></span>\\n<span class=\\"token keyword module\\">export</span> <span class=\\"token keyword module\\">default</span> <span class=\\"token punctuation\\">{</span>\\n<span class=\\"token function\\">data</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n        <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">{</span>\\n            departmentList<span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">,</span>\\n            department<span class=\\"token operator\\">:</span> <span class=\\"token string\\">\'\'</span>\\n        <span class=\\"token punctuation\\">}</span>\\n    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>\\n\\n    <span class=\\"token function\\">beforeCreate</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n        _this <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">this</span>\\n    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>\\n    methods<span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">{</span>\\n        handleSearch<span class=\\"token operator\\">:</span> _<span class=\\"token punctuation\\">.</span><span class=\\"token method function property-access\\">debounce</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">key<span class=\\"token punctuation\\">,</span> val</span><span class=\\"token punctuation\\">)</span> <span class=\\"token arrow operator\\">=></span> <span class=\\"token punctuation\\">{</span>\\n            <span class=\\"token keyword\\">let</span> p <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span> <span class=\\"token punctuation\\">[</span>key<span class=\\"token punctuation\\">]</span><span class=\\"token operator\\">:</span> val <span class=\\"token punctuation\\">}</span>\\n            <span class=\\"token function\\">queryAsset</span><span class=\\"token punctuation\\">(</span>p<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token method function property-access\\">then</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">res</span> <span class=\\"token arrow operator\\">=></span> <span class=\\"token punctuation\\">{</span>\\n                <span class=\\"token keyword\\">switch</span> <span class=\\"token punctuation\\">(</span><span class=\\"token known-class-name class-name\\">Object</span><span class=\\"token punctuation\\">.</span><span class=\\"token method function property-access\\">keys</span><span class=\\"token punctuation\\">(</span>p<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">[</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n                    <span class=\\"token keyword\\">case</span> <span class=\\"token string\\">\'department\'</span><span class=\\"token operator\\">:</span>\\n                        _this<span class=\\"token punctuation\\">.</span><span class=\\"token property-access\\">departmentList</span> <span class=\\"token operator\\">=</span> res<span class=\\"token punctuation\\">.</span><span class=\\"token property-access\\">data</span>\\n                        <span class=\\"token keyword\\">break</span>\\n                    <span class=\\"token comment\\">//省略</span>\\n                <span class=\\"token punctuation\\">}</span>\\n            <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span>\\n        <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">500</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>\\n\\n        <span class=\\"token function\\">handleChange</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">key<span class=\\"token punctuation\\">,</span> val</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n            <span class=\\"token keyword\\">switch</span> <span class=\\"token punctuation\\">(</span>key<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n                <span class=\\"token keyword\\">case</span> <span class=\\"token string\\">\'department\'</span><span class=\\"token operator\\">:</span>\\n                    <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span><span class=\\"token property-access\\">department</span> <span class=\\"token operator\\">=</span> val\\n                    <span class=\\"token keyword\\">break</span>\\n                <span class=\\"token comment\\">//省略</span>\\n            <span class=\\"token punctuation\\">}</span>\\n        <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>\\n  <span class=\\"token comment\\">//省略</span>\\n  <span class=\\"token punctuation\\">}</span>\\n<span class=\\"token punctuation\\">}</span>\\n<span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span>script<span class=\\"token operator\\">></span></pre>\\n<p>参考：</p>\\n<p><a href=\\"https://stackoverflow.com/questions/53041171/lodashs-debounce-not-working-in-vue-js\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">https://stackoverflow.com/questions/53041171/lodashs-debounce-not-working-in-vue-js</a></p>\\n<p><a href=\\"https://es6.ruanyifeng.com/?search=%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0&#x26;x=0&#x26;y=0#docs/function#%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0\\" target=\\"_blank\\" rel=\\"nofollow noopener noreferrer\\">https://es6.ruanyifeng.com/?search=箭头函数&#x26;x=0&#x26;y=0#docs/function#箭头函数</a></p>\\n"}}]}}}}')}}]);